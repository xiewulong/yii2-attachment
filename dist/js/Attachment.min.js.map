{"version":3,"sources":["Attachment.js"],"names":["$","window","document","undefined","Attachment","input","fn","prop","arguments","length","_classCallCheck","this","_name","$parent","action","$input","attr","multiple","csrf","param","csrf_param","token","before","parent","value","upload","_createClass","key","_this","pre","call","createElements","name","d","callback","$form","submit","$iframe","appendTo","append","random","Date","toString","Math","floor","remove","trigger","attachment","on","jQuery"],"mappings":"8XAOA,SAAEA,EAAGC,EAAQC,EAAUC,GAAc,GAE9BC,GAF8B,WAInC,QAAAA,GAAYC,EAAOC,GAAe,GAAXC,GAAWC,UAAAC,QAAA,GAAAD,UAAA,KAAAL,KAAAK,UAAA,EAAAE,iBAAAC,KAAAP,GACjCO,KAAKN,MAAQA,EALfM,KAAAC,MAAIX,KAAJI,MAAYH,KAAwBS,KAE9BP,OAF8BJ,EAAAK,GAInCM,KAAAE,QAAAF,KAAYN,OAAOC,SAAeK,KAAXJ,OAAWA,EAAAO,QAAAH,KAAAI,OAAAC,KAAA,iCAMjCL,KAAKM,SAAWV,EAAKU,UAAYN,KAAKI,OAAOC,KAAK,4BANjBL,KAAAO,MAQhCC,MAAOZ,EAAKa,YAAcT,KAAKI,OAAOC,KAAK,oBAAsB,QAPlEK,MAAKhB,EAAQA,YAAbM,KAAAI,OAAAC,KAAA,oBAEAL,KAAKI,IAALR,EAAgBF,KAAhB,aACAM,KAAKE,OAALN,EAAee,QAAYC,aAC3BZ,KAAKG,GAAAA,EAELH,KAAKO,MAALM,OAAYb,KAAAG,QAAAH,KAAAL,IAAAK,KAAAc,SAXsB,MAAAC,cAAAtB,IAAAuB,IAAA,SAAAH,MAAA,WAWlC,GAAAI,GAAAjB,IAIAA,MAAKkB,QAAMtB,KAAAe,OAAYQ,KAAAnB,KAAvBN,OAEAM,KAAKL,UASLK,KAAKoB,iBANL9B,EAAAU,KAAAqB,MAAA,SAAAC,GASCL,EAAKM,SAASD,IA7BmBtB,KAAAwB,MAAAC,YAAAT,IAAA,iBAAAH,MAAA,WAoClCb,KAAK0B,QAAUrC,EAAE,uCAAyCW,KAAKqB,KAAO,eAAeM,SAAS,QAX9F3B,KAAAwB,MAAAnC,EAAA,uCAAAW,KAAAG,OAAA,aAAAH,KAAAqB,KAAA,yDAAAM,SAAA,QACA3B,KAAAM,UAAKc,KAALI,MAAAI,OAAA,+CAAA5B,KAAAM,SAAA,QAaAN,KAAKO,KAAKG,OAASV,KAAKwB,MAAMI,OAAO,8BAAgC5B,KAAKO,KAAKC,MAAQ,YAAcR,KAAKO,KAAKG,MAAQ,QAXvHpB,KAAAA,MAAOsC,OAAP,2CAA2B5B,KAAAqB,KAAA,QAC1BrB,KAAAwB,MAAKD,OAALvB,KAAAN,UA7BiCsB,IAAA,UAAAH,MAAA,WAiClC,GAAAgB,KAAA,GAAAC,OAAAC,WAAAC,KAAAC,MAAA,IAAAD,KAAAH,SAAA,KAAAE,UAjCkC/B,MAAAqB,KAAArB,KAAAkB,IAAAW,EAAA7B,KAAAN,MAAA2B,KAAArB,KAAAqB,MAAArB,KAmClBM,SAAA,KAAA,OAnCkBU,IAAA,WAAAH,MAAA,SAsC7BP,GACLN,KAAAN,MAAUgB,KAAVV,KAAmBC,MACnBD,KAAAN,MAAAmB,MAAkB,GAClBb,KAAAE,QAAW0B,OAAO5B,KAAKN,OACvBM,KAAAwB,MAAAU,SA1CkClC,KAAA0B,QAAAQ,SAAAlC,KAAAL,GAAAwB,KAAAnB,KAAAN,MAAA4B,OAAA7B,IAgDlCJ,GAAAE,GAAKG,GAAM2B,SAAO,2BAA6B,WAC/C,GAAA5B,GAAAO,KAAA,SAAAsB,GAjDkCjC,EAAAW,MAAAmC,QAAA,2BAAAb,KAAAX,OAAA,WAoDlCtB,EAAAW,MAAKN,QAAL,+BAKAL,EAAAM,GAAAyC,WAAa,SAAbzC,EAAAC,GACA,MAAAI,MAAAqC,GAAA,SAAA,WA1DkC,GAAA5C,GAAAO,KAAAL,EAAAC,OA8ElC0C,OAAQhD,OAAQC","file":"Attachment.min.js","sourcesContent":["/*!\n * Attachment\n * xiewulong <xiewulong@vip.qq.com>\n * create: 2016/8/27\n * version: 0.0.1\n */\n\n(($, window, document, undefined) => {\n\n\tclass Attachment {\n\n\t\tconstructor(input, fn, prop = {}) {\n\t\t\tthis.input = input;\n\t\t\tthis._name = this.input.name;\n\t\t\tthis.$input = $(input);\n\t\t\tthis.$parent = this.$input.parent();\n\t\t\tthis.action = prop.action || this.$input.attr('data-attachment-upload-action');\n\t\t\tthis.multiple = prop.multiple || this.$input.attr('data-attachment-multiple');\n\t\t\tthis.csrf = {\n\t\t\t\tparam: prop.csrf_param || this.$input.attr('data-csrf-param') || '_csrf',\n\t\t\t\ttoken: prop.csrf_token || this.$input.attr('data-csrf-token'),\n\t\t\t};\n\t\t\tthis.pre = prop.pre || 'Attachment';\n\t\t\tthis.before = prop.before || function() {};\n\t\t\tthis.fn = fn;\n\n\t\t\tthis.input.value && this.action && this.fn && this.upload();\n\t\t}\n\n\t\tupload() {\n\t\t\tthis.before && this.before.call(this.input);\n\n\t\t\tthis.setName();\n\t\t\tthis.createElements();\n\n\t\t\twindow[this.name] = (d) => {\n\t\t\t\tthis.callback(d);\n\t\t\t};\n\n\t\t\tthis.$form.submit();\n\t\t}\n\n\t\tcreateElements() {\n\t\t\tthis.$iframe = $('<iframe style=\"display:none;\" name=\"' + this.name + '\"></iframe>').appendTo('body');\n\t\t\tthis.$form = $('<form style=\"display:none;\" action=\"' + this.action + '\" target=\"' + this.name + '\" method=\"post\" enctype=\"multipart/form-data\"></form>').appendTo('body');\n\t\t\tthis.multiple && this.$form.append('<input type=\"hidden\" name=\"multiple\" value=\"' + this.multiple + '\" />');\n\t\t\tthis.csrf.token && this.$form.append('<input type=\"hidden\" name=\"' + this.csrf.param + '\" value=\"' + this.csrf.token + '\" />');\n\t\t\tthis.$form.append('<input type=\"hidden\" name=\"name\" value=\"' + this.name + '\" />');\n\t\t\tthis.$form.append(this.input);\n\t\t}\n\n\t\tsetName() {\n\t\t\tlet random = (+ new Date()).toString() + Math.floor(Math.random() * 999 + 100).toString();\n\n\t\t\tthis.name = this.pre + random;\n\t\t\tthis.input.name = this.name + (this.multiple ? '[]' : '');\n\t\t}\n\n\t\tcallback(d) {\n\t\t\tthis.input.name = this._name;\n\t\t\tthis.input.value = '';\n\t\t\tthis.$parent.append(this.input);\n\t\t\tthis.$form.remove();\n\t\t\tthis.$iframe.remove();\n\t\t\tthis.fn.call(this.input, d);\n\t\t}\n\n\t}\n\n\t$(document).on('change', '[data-attachment-upload]', function() {\n\t\tnew Attachment(this, function(d) {\n\t\t\t$(this).trigger('uploaded.attachment.file', d);\n\t\t}, {\n\t\t\t'before': function() {\n\t\t\t\t$(this).trigger('upload.attachment.file');\n\t\t\t}\n\t\t});\n\t});\n\n\t$.fn.attachment = function(fn, prop) {\n\t\treturn this.on('change', function() {\n\t\t\tnew Attachment(this, fn, prop);\n\t\t});\n\t};\n\n})(jQuery, window, document);\n"],"sourceRoot":"/source/"}