{"version":3,"sources":["Attachment.js"],"names":["$","window","document","undefined","Attachment","input","fn","prop","_name","name","$input","$parent","parent","action","attr","multiple","csrf","param","csrf_param","token","csrf_token","pre","before","value","upload","call","setName","createElements","d","callback","$form","submit","$iframe","appendTo","append","random","Date","toString","Math","floor","remove","on","trigger","attachment","jQuery"],"mappings":"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","file":"Attachment.js","sourcesContent":["/*!\n * Attachment\n * xiewulong <xiewulong@vip.qq.com>\n * create: 2016/8/27\n * version: 0.0.1\n */\n\n(($, window, document, undefined) => {\n\n\tclass Attachment {\n\n\t\tconstructor(input, fn, prop = {}) {\n\t\t\tthis.input = input;\n\t\t\tthis._name = this.input.name;\n\t\t\tthis.$input = $(input);\n\t\t\tthis.$parent = this.$input.parent();\n\t\t\tthis.action = prop.action || this.$input.attr('data-attachment-upload-action');\n\t\t\tthis.multiple = prop.multiple || this.$input.attr('data-attachment-multiple');\n\t\t\tthis.csrf = {\n\t\t\t\tparam: prop.csrf_param || this.$input.attr('data-csrf-param') || '_csrf',\n\t\t\t\ttoken: prop.csrf_token || this.$input.attr('data-csrf-token'),\n\t\t\t};\n\t\t\tthis.pre = prop.pre || 'Attachment';\n\t\t\tthis.before = prop.before || function() {};\n\t\t\tthis.fn = fn;\n\n\t\t\tthis.input.value && this.action && this.fn && this.upload();\n\t\t}\n\n\t\tupload() {\n\t\t\tthis.before && this.before.call(this.input);\n\n\t\t\tthis.setName();\n\t\t\tthis.createElements();\n\n\t\t\twindow[this.name] = (d) => {\n\t\t\t\tthis.callback(d);\n\t\t\t};\n\n\t\t\tthis.$form.submit();\n\t\t}\n\n\t\tcreateElements() {\n\t\t\tthis.$iframe = $('<iframe style=\"display:none;\" name=\"' + this.name + '\"></iframe>').appendTo('body');\n\t\t\tthis.$form = $('<form style=\"display:none;\" action=\"' + this.action + '\" target=\"' + this.name + '\" method=\"post\" enctype=\"multipart/form-data\"></form>').appendTo('body');\n\t\t\tthis.multiple && this.$form.append('<input type=\"hidden\" name=\"multiple\" value=\"' + this.multiple + '\" />');\n\t\t\tthis.csrf.token && this.$form.append('<input type=\"hidden\" name=\"' + this.csrf.param + '\" value=\"' + this.csrf.token + '\" />');\n\t\t\tthis.$form.append('<input type=\"hidden\" name=\"name\" value=\"' + this.name + '\" />');\n\t\t\tthis.$form.append(this.input);\n\t\t}\n\n\t\tsetName() {\n\t\t\tlet random = (+ new Date()).toString() + Math.floor(Math.random() * 999 + 100).toString();\n\n\t\t\tthis.name = this.pre + random;\n\t\t\tthis.input.name = this.name + (this.multiple ? '[]' : '');\n\t\t}\n\n\t\tcallback(d) {\n\t\t\tthis.input.name = this._name;\n\t\t\tthis.input.value = '';\n\t\t\tthis.$parent.append(this.input);\n\t\t\tthis.$form.remove();\n\t\t\tthis.$iframe.remove();\n\t\t\tthis.fn.call(this.input, d);\n\t\t}\n\n\t}\n\n\t$(document).on('change', '[data-attachment-upload]', function() {\n\t\tnew Attachment(this, function(d) {\n\t\t\t$(this).trigger('uploaded.attachment.file', d);\n\t\t}, {\n\t\t\t'before': function() {\n\t\t\t\t$(this).trigger('upload.attachment.file');\n\t\t\t}\n\t\t});\n\t});\n\n\t$.fn.attachment = function(fn, prop) {\n\t\treturn this.on('change', function() {\n\t\t\tnew Attachment(this, fn, prop);\n\t\t});\n\t};\n\n})(jQuery, window, document);\n"],"sourceRoot":"/source/"}